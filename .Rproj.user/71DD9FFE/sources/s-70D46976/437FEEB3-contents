library(tidyverse); library(extrafont)

Accidents_Dec2015 <- read.csv("~/Kaggle/Car Accidents/Accidents0515.csv") %>% 
  mutate(Date = lubridate::ymd(Date)) %>% 
  dplyr::filter(Date >= lubridate::ymd(20151201)) %>% 
  mutate(Accident_Severity = case_when(Accident_Severity == 1 ~ 'Fatal',
                                       Accident_Severity == 2 ~ 'Serious',
                                       Accident_Severity == 3 ~ 'Slight'))
  
UK_coords <- ggplot2::map_data(map = 'world', region = 'UK')

accidents_plot <- ggplot(data = UK_coords)+
  geom_polygon(mapping = aes(x = long, y = lat, group = group), col = 'black', fill = NA)+
  theme_void(base_size = 12, base_family = 'Bahnschrift')+
  geom_point(data = Accidents_Dec2015 %>% dplyr::filter(grepl(pattern = 'Slight', x = Accident_Severity)), 
             mapping = aes(x = Longitude, y = Latitude, col = as.factor(Accident_Severity), size = Number_of_Casualties), 
             alpha = 0.1)+
  geom_point(data = Accidents_Dec2015 %>% dplyr::filter(grepl(pattern = 'Serious', x = Accident_Severity)), 
             mapping = aes(x = Longitude, y = Latitude, col = as.factor(Accident_Severity), size = Number_of_Casualties), 
             alpha = 0.2)+
  geom_point(data = Accidents_Dec2015 %>% dplyr::filter(grepl(pattern = 'Fatal', x = Accident_Severity)), 
             mapping = aes(x = Longitude, y = Latitude, col = as.factor(Accident_Severity), size = Number_of_Casualties), 
             alpha = 0.4)+
  theme(legend.position = 'right')+
  scale_color_manual(values = c('firebrick', 'forestgreen', 'steelblue'))+
  guides(col = guide_legend(title = element_blank(), ncol = 1),
         size = guide_legend(title = element_text('Casualties', size = 10), ncol = 1))

library(gganimate)

accidents_plot <- accidents_plot +
  transition_time(time = Date)+
  shadow_trail()+
  ggtitle(label = 'UK Car Accidents in December 2015', subtitle = 'Date : {frame_time}')

animate(plot = accidents_plot, height = 1000, width = 800)# fps = 30, duration = 60)

